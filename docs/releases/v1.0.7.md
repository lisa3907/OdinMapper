# Simple.AutoMapper v1.0.7

Release date: 2025-08-24

## Highlights
- PreserveReferences now strictly gates caching and circular-reference checks.
- Depth tracking increments only when PreserveReferences is enabled, reducing unnecessary overhead.
- Mapping engine reuses cached destination only for circular references when PreserveReferences is on, preventing stack overflows while keeping default behavior simple.

## Changes
- MappingContext
  - Bypass IsCircularReference, CacheDestination, and GetCachedDestination when PreserveReferences is false.
  - Increment current depth only if PreserveReferences is enabled.
- MappingEngine
  - On circular detection with PreserveReferences=true, assign destination from cache; otherwise map normally.
  - Clear compiled map cache for a TypePair when a new CreateMap is registered to avoid stale delegates.
- Tests
  - Added/updated circular reference tests to verify behavior with both PreserveReferences enabled and disabled.

## Bug Fixes
- Eliminated stack overflows in circular graphs when PreserveReferences is enabled by using cached destinations appropriately.
- Prevented unintended instance reuse when PreserveReferences is disabled.

## Behavior Notes
- If your code previously relied on implicit instance reuse without explicitly enabling PreserveReferences, you must now opt in: call PreserveReferences() on the map configuration.

## Known Issues / Next Up
- ForMember(MapFrom) has pending improvements for some scenarios (simple property, computed expression, collection projection); related tests are currently skipped.
- MaxDepth guard remains limited; full enforcement and tests will be re-enabled in a future release.

## Upgrade Guide
- Review maps that traverse circular graphs and enable PreserveReferences() where stable identity is required.
- No API surface changes; behavior is more explicit and predictable by default.